<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ SonnyWorld</title>
    <style>
        :root { --blue: #3b82f6; --green: #10b981; --red: #ef4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #f8fafc; color: #1e293b; }
        .admin-container { max-width: 1200px; margin: auto; padding: 20px; }
        
        .header { background: linear-gradient(135deg, #1e3a8a 0%, var(--blue) 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h2 { font-size: 32px; color: var(--blue); margin-bottom: 10px; }
        
        .orders-table { width: 100%; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin: 30px 0; }
        .orders-table th, .orders-table td { padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .orders-table th { background: #f1f5f9; font-weight: bold; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: 600; }
        .btn-success { background: var(--green); }
        .btn-danger { background: var(--red); }
        
        .search-box { background: white; padding: 20px; border-radius: 10px; margin: 30px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .search-box input { padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; width: 300px; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å SonnyWorld</h1>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–Ω–∞—Ç–∞–º–∏</p>
            <a href="index.html" style="color: white; margin-top: 15px; display: inline-block;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>
        </div>
        
        <div class="search-box">
            <h3><i class="fas fa-search"></i> –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –ø–æ ID</h3>
            <input type="text" id="searchOrderId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞ (SW...)">
            <button class="btn" onclick="searchOrder()" style="background: var(--blue);">–ù–∞–π—Ç–∏</button>
            <button class="btn" onclick="refreshOrders()" style="background: var(--green); margin-left: 10px;">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h2 id="totalOrders">0</h2>
                <p>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
            </div>
            <div class="stat-card">
                <h2 id="totalIncome">0 ‚ÇΩ</h2>
                <p>–û–±—â–∏–π –¥–æ—Ö–æ–¥</p>
            </div>
            <div class="stat-card">
                <h2 id="pendingOrders">0</h2>
                <p>–û–∂–∏–¥–∞—é—Ç –≤—ã–¥–∞—á–∏</p>
            </div>
            <div class="stat-card">
                <h2 id="completedOrders">0</h2>
                <p>–í—ã–¥–∞–Ω–æ</p>
            </div>
        </div>
        
        <h2>–ó–∞–∫–∞–∑—ã –æ–∂–∏–¥–∞—é—â–∏–µ –≤—ã–¥–∞—á–∏</h2>
        <table class="orders-table">
            <thead>
                <tr>
                    <th>ID –∑–∞–∫–∞–∑–∞</th>
                    <th>–ò–≥—Ä–æ–∫</th>
                    <th>–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="ordersList">
                <tr><td colspan="8" style="text-align: center; padding: 30px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</td></tr>
            </tbody>
        </table>
    </div>
    
    <script>
        // –ü–ê–†–û–õ–¨ –ê–î–ú–ò–ù–ö–ò: sonny2026
        const password = prompt("–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:");
        if (password !== "sonny2026") {
            alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
            window.location.href = "index.html";
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        function loadOrders() {
            try {
                const orders = JSON.parse(localStorage.getItem('sonny_orders')) || [];
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                document.getElementById('totalOrders').textContent = orders.length;
                document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
                document.getElementById('completedOrders').textContent = orders.filter(o => o.status === 'completed').length;
                
                const paidOrders = orders.filter(o => !o.isFree && o.status === 'completed');
                const totalIncome = paidOrders.reduce((sum, order) => sum + order.price, 0);
                document.getElementById('totalIncome').textContent = totalIncome + ' ‚ÇΩ';
                
                // –¢–∞–±–ª–∏—Ü–∞
                const ordersList = document.getElementById('ordersList');
                ordersList.innerHTML = '';
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∂–∏–¥–∞—é—â–∏–µ, –ø–æ—Ç–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                const pendingOrders = orders.filter(o => o.status === 'pending').reverse();
                const completedOrders = orders.filter(o => o.status === 'completed').reverse();
                
                if (pendingOrders.length === 0 && completedOrders.length === 0) {
                    ordersList.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</td></tr>';
                    return;
                }
                
                // –û–∂–∏–¥–∞—é—â–∏–µ
                pendingOrders.forEach(order => {
                    addOrderRow(order, 'pending');
                });
                
                // –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                completedOrders.forEach(order => {
                    addOrderRow(order, 'completed');
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                document.getElementById('ordersList').innerHTML = 
                    '<tr><td colspan="8" style="text-align: center; padding: 30px; color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</td></tr>';
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É
        function addOrderRow(order, status) {
            const ordersList = document.getElementById('ordersList');
            const date = new Date(order.date).toLocaleString('ru-RU');
            const completedDate = order.completedAt ? new Date(order.completedAt).toLocaleString('ru-RU') : '-';
            
            const row = document.createElement('tr');
            row.style.background = status === 'completed' ? '#f0fdf4' : 'white';
            
            row.innerHTML = `
                <td><code>${order.id}</code></td>
                <td><strong>${order.nickname}</strong><br><small>–ü–æ–¥–ø–∏—Å—å: ${order.signature}</small></td>
                <td>${order.donate}</td>
                <td>${order.isFree ? '<span style="color: var(--green);">0 ‚ÇΩ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</span>' : order.price + ' ‚ÇΩ'}</td>
                <td>${date}</td>
                <td>${order.isFree ? 'üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : 'üí∞ –ü–ª–∞—Ç–Ω—ã–π'}</td>
                <td>
                    ${status === 'pending' 
                        ? '<span style="color: #f59e0b; font-weight: bold;">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>' 
                        : '<span style="color: var(--green); font-weight: bold;">‚úÖ –í—ã–¥–∞–Ω</span><br><small>' + completedDate + '</small>'}
                </td>
                <td>
                    ${status === 'pending' 
                        ? `<button class="btn btn-success" onclick="completeOrder('${order.id}')" style="margin-right: 5px;">
                              <i class="fas fa-check"></i> –í—ã–¥–∞—Ç—å
                           </button>
                           <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">
                              <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                           </button>`
                        : `<button class="btn" onclick="copyCommand('${order.nickname}', '${order.donate}')" style="background: var(--blue);">
                              <i class="fas fa-copy"></i> –ö–æ–º–∞–Ω–¥–∞
                           </button>`}
                </td>
            `;
            ordersList.appendChild(row);
        }
        
        // –í—ã–¥–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é
        function completeOrder(orderId) {
            const orders = JSON.parse(localStorage.getItem('sonny_orders')) || [];
            const orderIndex = orders.findIndex(o => o.id === orderId);
            
            if (orderIndex === -1) {
                alert("–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                return;
            }
            
            const order = orders[orderIndex];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–ø–ª–∞—á–µ–Ω –ª–∏ –∑–∞–∫–∞–∑
            if (!order.isFree) {
                const checkPayment = confirm(`–ó–∞–∫–∞–∑ ${orderId} –Ω–∞ —Å—É–º–º—É ${order.price} ‚ÇΩ\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ?\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ—à–µ–ª—å–∫–µ –ÆMoney –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π.`);
                if (!checkPayment) return;
            }
            
            const groupName = order.donate.toLowerCase().replace('.', '').replace(' ', '_');
            const command = `/lp user ${order.nickname} parent add ${groupName}`;
            
            if (confirm(`–í—ã–¥–∞—Ç—å ${order.donate} –∏–≥—Ä–æ–∫—É ${order.nickname}?\n\n–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–¥–∞—á–∏:\n${command}`)) {
                // –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É
                navigator.clipboard.writeText(command).then(() => {
                    // –ú–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
                    orders[orderIndex].status = 'completed';
                    orders[orderIndex].completedAt = new Date().toISOString();
                    localStorage.setItem('sonny_orders', JSON.stringify(orders));
                    
                    alert("‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!\n\n–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –≤—ã–¥–∞—á–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏.");
                    loadOrders();
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º
                    try {
                        new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3').play();
                    } catch (e) {}
                }).catch(err => {
                    alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã: " + err);
                });
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
        function copyCommand(nickname, donate) {
            const groupName = donate.toLowerCase().replace('.', '').replace(' ', '_');
            const command = `/lp user ${nickname} parent add ${groupName}`;
            
            navigator.clipboard.writeText(command).then(() => {
                alert("‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞:\n" + command);
            });
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑
        function deleteOrder(orderId) {
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) return;
            
            const orders = JSON.parse(localStorage.getItem('sonny_orders')) || [];
            const filteredOrders = orders.filter(o => o.id !== orderId);
            localStorage.setItem('sonny_orders', JSON.stringify(filteredOrders));
            
            loadOrders();
            alert("–ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω");
        }
        
        // –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑
        function searchOrder() {
            const orderId = document.getElementById('searchOrderId').value.trim();
            if (!orderId) {
                alert("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞!");
                return;
            }
            
            const orders = JSON.parse(localStorage.getItem('sonny_orders')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                alert("–ó–∞–∫–∞–∑ —Å —Ç–∞–∫–∏–º ID –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                return;
            }
            
            const date = new Date(order.date).toLocaleString('ru-RU');
            const completedDate = order.completedAt ? new Date(order.completedAt).toLocaleString('ru-RU') : '–ù–µ –≤—ã–¥–∞–Ω–æ';
            const status = order.status === 'completed' ? '‚úÖ –í—ã–¥–∞–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–¥–∞—á–∏';
            const type = order.isFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : '–ü–ª–∞—Ç–Ω—ã–π';
            
            Swal.fire({
                title: `–ó–∞–∫–∞–∑ ${orderId}`,
                html: `
                    <div style="text-align: left; padding: 10px;">
                        <p><b>–ò–≥—Ä–æ–∫:</b> ${order.nickname}</p>
                        <p><b>–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è:</b> ${order.donate}</p>
                        <p><b>–°—É–º–º–∞:</b> ${order.isFree ? '0 ‚ÇΩ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)' : order.price + ' ‚ÇΩ'}</p>
                        <p><b>–¢–∏–ø:</b> ${type}</p>
                        <p><b>–°—Ç–∞—Ç—É—Å:</b> ${status}</p>
                        <p><b>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:</b> ${date}</p>
                        <p><b>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</b> ${completedDate}</p>
                        <p><b>–ü–æ–¥–ø–∏—Å—å:</b> ${order.signature}</p>
                        <hr>
                        <p style="color: #6b7280; margin-top: 10px;">
                            –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–¥–∞—á–∏: /lp user ${order.nickname} parent add ${order.donate.toLowerCase().replace('.', '').replace(' ', '_')}
                        </p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: '–ó–∞–∫—Ä—ã—Ç—å',
                confirmButtonColor: '#3b82f6'
            });
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
        function refreshOrders() {
            loadOrders();
            document.getElementById('searchOrderId').value = '';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        function startAutoRefresh() {
            loadOrders();
            setTimeout(startAutoRefresh, 30000); // 30 —Å–µ–∫—É–Ω–¥
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            startAutoRefresh();
        });
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
